import pandas as pd

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”„ íŒŒì¼ ê²½ë¡œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eye_path = "eye_movement_coordinates.csv"
imu_path = "imu_data.csv"  # í•„ìš” ì‹œ íŒŒì¼ëª… ìˆ˜ì •

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“‚ CSV ë¡œë“œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eye_df = pd.read_csv(eye_path)
imu_df = pd.read_csv(imu_path)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Œ Timestamp ì •ë ¬ ë° ë³‘í•© (nearest join)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eye_df['timestamp'] = pd.to_datetime(eye_df['timestamp'], unit='s')
imu_df['timestamp'] = pd.to_datetime(imu_df['timestamp'], unit='s')

# ê°€ì¥ ê°€ê¹Œìš´ timestamp ê¸°ì¤€ ë³‘í•© (pandas 1.5+ í•„ìš”)
merged_df = pd.merge_asof(
    eye_df.sort_values('timestamp'),
    imu_df.sort_values('timestamp'),
    on='timestamp',
    direction='nearest',
    tolerance=pd.Timedelta('50ms')  # 0.05ì´ˆ ì°¨ì´ê¹Œì§€ í—ˆìš©
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ’¾ ì €ì¥
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
merged_df.to_csv("merged_eye_imu.csv", index=False)
print("âœ… ì €ì¥ ì™„ë£Œ: merged_eye_imu.csv")
